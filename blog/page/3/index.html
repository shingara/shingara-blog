
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Shiny happy people coding</title>
  <meta name="author" content="Cyril Mougel">

  
  <meta name="description" content="Il y a peu au boulot, j&#8217;ai indiqué ma désapprobation des Observeurs face au Callback. Je vais donc le coucher ici par écrit mon sentiment. L&# &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.shingara.fr//blog/page/3/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Shiny happy people coding" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11352302-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Shiny happy people coding</a></h1>
  
    <h2>Codons avec le sourire</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.shingara.fr/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/observer-vs-callback.html">Observer Vs Callback</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-06-14T00:00:00+02:00" pubdate data-updated="true">Jun 14<span>th</span>, 2009</time>
        
         | <a href="/observer-vs-callback.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Il y a peu au boulot, j&#8217;ai indiqué ma désapprobation des Observeurs face au Callback. Je vais donc le coucher ici par écrit mon sentiment.</p>

<h2>L&#8217;Observeur</h2>

<p>Dans Rails, il y a au premier abord une fonctionnalité vraiment intéressante. L&#8217;<a href="http://api.rubyonrails.org/classes/ActiveRecord/Observer.html">Observeur</a>. Grâce à lui, on peux définir une classe qui vérifie le comportement d&#8217;un model et effectue certaine action suite à ses observations. Il permet d&#8217;ajouter des événements avant/après l&#8217;enregistrement, la mise a jour ou la destruction d&#8217;un model.</p>

<p>Pour mettre en place un observeur, il suffit de créer une classe héritant de <code>ActiveRecord::Observer</code>, mettre son code dedans et la définir comme observeur dans le fichier environment.rb. Rien de plus simple et ça marche très bien.</p>

<h2>Le Callback</h2>

<p>Mais Rails a déjà intégré dans ses models, les fonctions de callback utilisé par le observeur. En effet, on peux tout à fait définir N action after_save ou before_create. Ces méthodes seront appelés à l&#8217;événement voulu.</p>

<h2>Mais que choisir ?</h2>

<p>C&#8217;est là où je dis que le callback est plus intéressant que l&#8217;observeur. En effet, un callback fait exactement la même chose qu&#8217;un Observeur. Mais lui au moins on sait qu&#8217;il est là. En ouvrant la classe on découvre le callback. Pour détecter un Observeur, il faut regarder les fichiers de config de Rails et ouvrir une à une les classes Observeurs.</p>

<p>Même le cas du nombre de ligne n&#8217;est pas réel car il est tout à fait possible de sortir ses callbacks dans des modules. De même pour une réutilisation sur plusieurs classes. Le module le permet sans problème.</p>

<p>Personnellement, je n&#8217;ai jamais constater un seul cas où l&#8217;observeur avait plus d&#8217;intérêt que des callback. Si vous en trouvez, je suis vraiment curieux.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/cucumber-0-3-4-et-merb-la-dure-cohabitation.html">Cucumber>=0.3.4 et Merb. La dure cohabitation</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-05-24T00:00:00+02:00" pubdate data-updated="true">May 24<span>th</span>, 2009</time>
        
         | <a href="/cucumber-0-3-4-et-merb-la-dure-cohabitation.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Depuis la sortie de <a href="http://cukes.info/">Cucumber</a> 0.3.4 et pour les versions suivantes, une grosse modification dans Cucumber impose de changer un peu son utilisation avec Merb. En effet, si on peux lire dans le <a href="http://github.com/aslakhellesoy/cucumber/blob/master/History.txt">History.txt</a> de Cucumber :</p>

<typo:code>
** IMPORTANT UPGRADE NOTES FOR RAILS USERS **
 
Running Cucumber features in the same Ruby interpreter as Rake doesn&#8217;t seem to work,
so you have to explicitly tell the task to fork (like it was doing by default in prior
versions). In lib/tasks/cucumber.rake:
 
  Cucumber::Rake::Task.new(:features) do |t|
    t.fork = true # Explicitly fork
    t.cucumber_opts = %w{&#8211;format pretty}
  end
 
(If you run script/generate cucumber this will be done for you).
Alternatively you can omit forking and run features like this:
 
  RAILS_ENV=test rake features
 
However, setting the RAILS_ENV is easy to forget, so I don&#8217;t recommend relying on this.
</typo:code>

<p>
Cela est aussi vrai pour les utilisateurs de Merb. En général pour les utilisateurs de Merb, vous avez utilisé le plugin <a href="http://github.com/roman/merb_cucumber/tree/master">merb_cucumber de Roman</a>. Hélas celui-ci a un générateur incomplet à l&#8217;heure actuel. En effet, la tâche <code>rake features</code> n&#8217;utilise pas les bonnes options pour cucumber.</p>

<p>Après un long et rude combat avec cucumber, j&#8217;ai fini par trouver les options adéquates pour avoir le même comportement que pour les précédentes version de Cucumber. Pour voir un exemple en &#8220;live&#8221; sur une application, vous pouvez regarder <a href="http://github.com/shingara/oupsnow/commit/13ab272f31bbf49537e9addc8166661ced91c694">mon commit sur Oupsnow</a>. Sinon, j&#8217;ai forké le merb_cucumber de roman, et ajouter <a href="http://github.com/shingara/merb_cucumber/commit/317d64d45204c01a6ccbadfe1bd95e5ad06f7012">un patch pour permettre l&#8217;utilisation de Cucumber 0.3.4 et plus</a></p>

<p>EDIT : Mes modifications de merb_cucumber ont été intégré dans la branche de Roman</p>

<p><a href="http://blog.shingara.fr/en/2009-05-24-since-cucumber-0-3-4-he-has-difficult-with-merb.html">English translation</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/watchman-en-alpha-par-jtek.html">Watchman en Alpha par JTEK</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-03-10T00:00:00+01:00" pubdate data-updated="true">Mar 10<span>th</span>, 2009</time>
        
         | <a href="/watchman-en-alpha-par-jtek.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Un de mes projets chez JTEK est la cr&eacute;ation de <a href="http://watchman.jtek.fr">Watchman</a>. Cette application permet d&#8217;aider &agrave; v&eacute;rifier la s&eacute;curit&eacute; de son serveur.</p>
<p><a href="http://www.jtek.fr/2009/03/09/watchman-automatiser-la-gestion-des-failles">Une annonce officielle</a> a ainsi ouvert Watchman en Alpha. N&#8217;h&eacute;sitez pas &agrave; le tester.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/railscampparis-2-jy-etais-et-cetait-sympa.html">RailsCampParis 2, j&#8217;y étais et c&#8217;était sympa</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-03-09T00:00:00+01:00" pubdate data-updated="true">Mar 9<span>th</span>, 2009</time>
        
         | <a href="/railscampparis-2-jy-etais-et-cetait-sympa.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ca y est le RailsCamp Paris 2, c&#8217;est terminé hier avec un mashpit sur Merb. Je ne l&#8217;ai pas annoncé sur ce blog, mais j&#8217;étais bien sûr présent. Les locaux de Sun où nous avons pu faire ce RailsCamp était vraiment très beau et spacieux. Nous avons pu y avoir de très bonne discussion. Merci à <a href="http://www.typouype.org/">Yannick</a> d&#8217;avoir tenu le bar et à Jean-François Tran d&#8217;avoir organisé cet événement.:).</p>

<p>Au niveau des présentations, étant depuis décembre un fervent défenseur de Merb/DataMapper, j&#8217;ai fait de petite présentation sur ces deux outils merveilleux. En voici les slides :</p>

<ul>
<li><div style="width:425px;text-align:left" id="__ss_1099349"><a style="font:14px Helvetica,Arial,Sans-serif;display:block;margin:12px 0 3px 0;text-decoration:underline;" href="http://www.slideshare.net/cyril.mougel/merb-le-framework-tellement-bien-qu-il-sera-integrer-dans-rails?type=powerpoint" title="Merb Le Framework Tellement Bien Qu Il Sera Integré Dans Rails">Merb Le Framework Tellement Bien Qu Il Sera Integré Dans Rails</a><object style="margin:0px" width="425" height="355"><param name="movie" value="http://static.slideshare.net/swf/ssplayer2.swf?doc=merb-le-framework-tellement-bien-qu-il-sera-integrer-dans-rails-090304053837-phpapp01&stripped_title=merb-le-framework-tellement-bien-qu-il-sera-integrer-dans-rails" /><param name="allowFullScreen" value="true"/><param name="allowScriptAccess" value="always"/><embed src="http://static.slideshare.net/swf/ssplayer2.swf?doc=merb-le-framework-tellement-bien-qu-il-sera-integrer-dans-rails-090304053837-phpapp01&stripped_title=merb-le-framework-tellement-bien-qu-il-sera-integrer-dans-rails" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="355"></embed></object><div style="font-size:11px;font-family:tahoma,arial;height:26px;padding-top:2px;">View more <a style="text-decoration:underline;" href="http://www.slideshare.net/">presentations</a> from <a style="text-decoration:underline;" href="http://www.slideshare.net/cyril.mougel">Cyril Mougel</a>. (tags: <a style="text-decoration:underline;" href="http://slideshare.net/tag/merb">merb</a> <a style="text-decoration:underline;" href="http://slideshare.net/tag/initiation">initiation</a>)</div></div></li>

<li><div style="width:425px;text-align:left" id="__ss_1105938"><a style="font:14px Helvetica,Arial,Sans-serif;display:block;margin:12px 0 3px 0;text-decoration:underline;" href="http://www.slideshare.net/cyril.mougel/datamapper-l-orm-dans-rails-3?type=powerpoint" title="Datamapper L Orm Dans Rails 3">Datamapper L Orm Dans Rails 3</a><object style="margin:0px" width="425" height="355"><param name="movie" value="http://static.slideshare.net/swf/ssplayer2.swf?doc=datamapper-l-orm-dans-rails-3-090305084222-phpapp01&stripped_title=datamapper-l-orm-dans-rails-3" /><param name="allowFullScreen" value="true"/><param name="allowScriptAccess" value="always"/><embed src="http://static.slideshare.net/swf/ssplayer2.swf?doc=datamapper-l-orm-dans-rails-3-090305084222-phpapp01&stripped_title=datamapper-l-orm-dans-rails-3" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="355"></embed></object><div style="font-size:11px;font-family:tahoma,arial;height:26px;padding-top:2px;">View more <a style="text-decoration:underline;" href="http://www.slideshare.net/">presentations</a> from <a style="text-decoration:underline;" href="http://www.slideshare.net/cyril.mougel">Cyril Mougel</a>. (tags: <a style="text-decoration:underline;" href="http://slideshare.net/tag/datamapper">datamapper</a> <a style="text-decoration:underline;" href="http://slideshare.net/tag/ruby">ruby</a>)</div></div></li>
</ul>

<p>Le lendemain, le mashpit sur Merb a ainsi vu l&#8217;apparition de 3 petit projets en Merb :</p>

<ul>
<li><a href="http://github.com/nmerouze/merbpitparis-quizz/tree/master">Un Twitter Quiz</a></li>
<li><a href="http://github.com/nel/merb-ec2/tree/master">Un gestionnaire d&#8217;instance EC2</a></li>
<li><a href="http://github.com/shingara/planet-mashpit/tree/master">Un petit planet en Merb</a></li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sortie-de-oupsnow-0-2-0-avec-mise-en-production.html">Sortie de Oupsnow 0.2.0 avec mise en production</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-10T00:00:00+01:00" pubdate data-updated="true">Feb 10<span>th</span>, 2009</time>
        
         | <a href="/sortie-de-oupsnow-0-2-0-avec-mise-en-production.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ca y est,  après moins d&#8217;un mois, voici la nouvelle version de <a href="http://oupsnow.rubyforge.org/">Oupsnow</a>. Cette version 0.2.0 est la première version que je mets moi même en production. En effet, désormais ma <a href="http://dev.shingara.fr/">platforme de développement</a> n&#8217;est plus propulsé par Redmine, c&#8217;est Oupsnow.</p>

<p>Les nouveautés de cette version sont les suivantes :</p>

<ul>
<li>Un converteur Redmine -> Oupsnow a été intégré. C&#8217;est grâce à lui que j&#8217;ai pu changer ma platforme de développement sans perte.</li>
</ul>

<p>On été ajouté :</p>
<ul>
<li>Une gestion des milestones</li>
<li>Une gestion des Etats des tickets</li>
<li>Une gestion des Sévérité des tickets</li>
<li>Formatage des textes avec RedCloth</li>
</ul>

<p>Après cette nouvelle release, j&#8217;ai vais pouvoir me reconcentrer sur Typo et ainsi faire <a href="http://typo.lighthouseapp.com/projects/11171/tickets/14-drop-acts_as_ressource-and-add-a-more-flexible-url-system">la fonctionnalité phare</a> de la <a href="http://typo.lighthouseapp.com/projects/11171/milestones/29390-typo-53">version 5.2.1</a>.</p>

<p><a href="http://blog.shingara.fr/en/2009-02-10-oupsnow-0-2-0-released.html">English translation</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sortie-de-typo-5-2.html">sortie de typo 5.2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-01-25T00:00:00+01:00" pubdate data-updated="true">Jan 25<span>th</span>, 2009</time>
        
         | <a href="/sortie-de-typo-5-2.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A mon tour de vous annoncer la sortie de <a href="http://blog.typosphere.org/2009/01/25/typo-5-2-helmut-newton-for-rails-2-2-released">Typo 5.2</a>. Cette sortie est la première sortie où je participe activement. En effet, depuis Août dernier, je suis contibuteur de <a href="http://typosphere.org/">Typo</a>. J&#8217;ai d&#8217;abord commencé par faire la migration de Typo sur Rails 2.2 (avant même la sortie officiel de Rails 2.2). J&#8217;ai ensuite continué avec <a href="http://t37.net/">Frédéric</a> à améliorer au maximum les performances et l&#8217;utilisabilité de Typo.</p>

<p>Aujourd&#8217;hui avec cette sortie de Typo, le travail est vraiment à la hauteur. Nous avons tout fait pour que cela soit optimum. Mais surtout nous n&#8217;avons pas fini. Nous avons ainsi énormément d&#8217;idée qui seront intégré dans Typo dans le futur. Nous allons aussi essayé de faire des releases plus régulièrement.</p>

<p>En bonus, voici mon fichier capistrano que j&#8217;utilise pour déployer Typo.</p>

<typo:code lang="ruby">
set :application, &#8220;typo&#8221;
set :repository,  &#8220;git://github.com/fdv/typo&#8221;
set :domain, &#8220;shingara.fr&#8221;

# If you aren&#8217;t deploying to /u/apps/#{application} on the target
# servers (which is the default), you can specify the actual location
# via the :deploy_to variable:
set :deploy_to, &#8220;/var/rails/blog-typo&#8221;

# If you aren&#8217;t using Subversion to manage your source code, specify
# your SCM below:
set :scm, :git
set :git_enable_submodules, 1

set :runner, &#8220;rails&#8221;
set :user, &#8220;rails&#8221;
set :use_sudo, false
set :thin_conf, &#8220;/etc/thin/typo.yml&#8221;

role :app, domain
role :web, domain
role :db,  domain, :primary => true

task :update_config, :roles => [:app] do
  run &#8220;ln -s #{shared_path}/config/database.yml #{release_path}/config/database.yml&#8221;
  run &#8220;ln -s #{shared_path}/files #{release_path}/public/files&#8221;
  run &#8220;ln -s #{shared_path}/cache #{release_path}/tmp/cache&#8221;
  run &#8220;ln -s #{shared_path}/newrelic_rpm #{release_path}/vendor/plugins/newrelic_rpm&#8221;
  run &#8220;ln -s #{shared_path}/config/newrelic.yml #{release_path}/config/newrelic.yml&#8221;
  run &#8220;ln -s #{shared_path}/config/agent #{release_path}/config/agent&#8221;
  run &#8220;ln -s #{shared_path}/config/mail.yml #{release_path}/config/mail.yml&#8221;
end

task :dump_before, :roles => [:app] do
  run &#8220;pg_dump -U typoblog typo > #{shared_path}/typo#{Time::today.strftime(&#8216;%Y-%m-%d&#8217;)}.sql&#8221;
end

namespace :deploy do
  task :start, :roles => [:app] do
    run &#8220;thin -C #{thin_conf} start&#8221;
  end

  task :stop, :roles => [:app] do
    run &#8220;thin -C #{thin_conf} stop&#8221;
  end

  task :restart, :roles => [:app] do
    run &#8220;thin -C #{thin_conf} restart&#8221;
  end
end

after &#8220;deploy:update_code&#8221;, :update_config
before &#8220;deploy:migrations&#8221;, :dump_before
</typo:code>
<p><a href="http://blog.shingara.fr/en/2009-01-25-typo-5-2-0-released.html">English translation</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sortie-de-la-premiere-version-de-oupsnow-0-1-0.html">Sortie de la première version de Oupsnow 0.1.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-01-21T00:00:00+01:00" pubdate data-updated="true">Jan 21<span>st</span>, 2009</time>
        
         | <a href="/sortie-de-la-premiere-version-de-oupsnow-0-1-0.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Je suis assez content de vous présenter <a href="http://oupsnow.rubyforge.org/">Oupsnow</a>. En effet, après avoir participé à redmine et l&#8217;avoir utilisé, j&#8217;ai décidé de créer mon propre bug tracker. Je trouvais de plus en plus de défauts à Redmine qui n&#8217;était pas comblé. Il est très fortement inspiré de Lighthouse qui a l&#8217;avantage d&#8217;être vraiment simple d&#8217;utilisation.</p>

<p>Voici donc la première version qui sort après 2 mois de développement. Elle est encore loin d&#8217;être un produit complètement fini. Mais elle commence à avoir un début de fonctionnalité suffisante. De plus Oupsnow est un produit réalisé avec Merb. J&#8217;ai ainsi pu découvrir et approfondir Merb grâce à ce projet.</p>

<p>Dans la prochaine release, j&#8217;améliorerais un peu l&#8217;administration. Je créerais aussi un convertisseur de Redmine vers Oupsnow. Cela entrainera ma migration vers Oupsnow à la place de redmine pour ma <a href="http://dev.shingara.fr/">plateforme de développement</a></p>

<p>J&#8217;ai mis en place une <a href="http://oupsnow.shingara.fr">version de démonstration</a> pour vous que ayez une idée de ce que Oupsnow permet.</p>

<p>En bonus, voici mon fichier <code>deploy.rb</code> qui m&#8217;a permis de déployer la version de démonstration de Oupsnow par capistrano</p>

<typo:code lang="ruby">
set :application, &#8220;oupsnow&#8221;
set :repository,  &#8220;git://github.com/shingara/oupsnow.git&#8221;
set :domain, &#8220;shingara.fr&#8221;

# If you aren&#8217;t deploying to /u/apps/#{application} on the target
# servers (which is the default), you can specify the actual location
# via the :deploy_to variable:
set :deploy_to, &#8220;/var/rails/oupsnow-demo&#8221;
set :deploy_via,            :remote_cache
set :repository_cache,      &#8220;#{application}-src&#8221;



# If you aren&#8217;t using Subversion to manage your source code, specify
# your SCM below:
# set :scm, :subversion
set :scm, :git
set :git_enable_submodules, 1

set :runner, &#8220;rails&#8221;
set :user, &#8220;rails&#8221;
set :use_sudo, false
set :rack_up, &#8220;/etc/thin/oupsnow-demo.ru&#8221;
set :merb_port, 46000

role :app, domain
role :web, domain
role :db,  domain, :primary => true

task :update_config, :roles => [:app] do
  run &#8220;ln -s #{shared_path}/config/database.yml #{release_path}/config/database.yml&#8221;
end

namespace :deploy do
  task :start, :roles => [:app] do
    run &#8220;merb -u #{user} -G #{user} -d -c 1 -p #{merb_port} -n #{application} -a thin -e production -m &#8216;#{deploy_to}/current/&#8217;&#8221;
  end

  task :stop, :roles => [:app] do
    run &#8220;merb -u #{user} -G #{user} -d -c 1 -K all -p #{merb_port} -n #{application} -a thin -e production -m &#8216;#{deploy_to}/current/&#8217;&#8221;
  end

  task :restart, :roles => [:app] do
    deploy.stop
    deploy.start
  end
end

after &#8220;deploy:update_code&#8221;, :update_config
</typo:code>

<p><a href="http://blog.shingara.fr/en/2009-01-21-oupsnow-0-1-0-released.html">English translation</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/les-merb-pretty-url.html">Les Merb pretty URL</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-01-19T00:00:00+01:00" pubdate data-updated="true">Jan 19<span>th</span>, 2009</time>
        
         | <a href="/les-merb-pretty-url.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Si comme moi vous être un fan des pretty URL, vous savez surement comment faire avec RubyOnRails. Il suffit de modifier le retour de la méthode <code>to_params</code>. Utilisant Merb, j&#8217;ai voulu faire de même avec Merb. J&#8217;ai bien sûr commencé par modifier la méthode <code>to_params</code>. Hélas, ce n&#8217;est pas du tout la bonne méthode à suivre avec Merb. Mais finalement, la méthode est encore plus simple. Ce qu&#8217;il faut c&#8217;est utiliser l&#8217;option <code>:identify</code> pour votre resources dans votre routeur. J&#8217;ai ainsi pu pour Oupsnow définir la méthode <code>ticket_permalink</code> comme méthode définissant un ticket. Je n&#8217;ai plus ensuite qu&#8217;a définir ce que je souhaite comme retour de permalink. Cette string de retour sera ainsi utilisée dans les URL générées par <code>resource</code>. En créant ensuite la méthode <code>def self.get_by_permalink(ticket_permalink)</code> que j&#8217;utilise à la place d&#8217;un <code>Ticket.get(id)</code>. je peux facilement modifier mon permalink dans le temps. En mettant ma valeur de retour de permalink et de récupération de ticket par ce permalink à jour.</p>

<p>Ce qu&#8217;il faut par contre savoir, c&#8217;est que contrairement à Rails, le paramètre utilisé ne sera donc plus <code>id</code> et <code>ticket_id</code> dans les routes imbriquées. Ça sera obligatoirement <code>ticket_permalink</code>.</p>

<p><a href="http://blog.shingara.fr/en/2009-01-21-pretty-url-in-merb.html">English translation</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gestion-des-dependances-avec-merb.html">Gestion des dépendances avec Merb</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-01-18T00:00:00+01:00" pubdate data-updated="true">Jan 18<span>th</span>, 2009</time>
        
         | <a href="/gestion-des-dependances-avec-merb.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Utilisant de plus en plus Merb sur mon temps personnel et dans mes projets open source, j&#8217;ai dû étudier un peu plus profondément le système de dépendances de Merb.</p>

<p>Merb est par essence un framework basé sur les gems. Dans cette logique il pousse à n&#8217;utiliser que des gems et uniquement ceux ci.</p>

<h1>Utilisation des gems avec Merb</h1>

<p>Pour utiliser un gem avec Merb, rien de plus simple car tout est prévu pour. Que ce soit avec votre répertoire local de gem ou alors avec un freeze du gems.</p>

<h2>Utilisation de votre répository gem local</h2>

<p>Si vous ne voulez utiliser que cette technique, alors rien de plus simple, modifier le fichier <code>/config/dependencies.rb</code> pour indiquer les gems à charger dans votre application. Voici par exemple le fichier <code>dépendencies.rb</code> d&#8217;une application installer de frais.</p>

<typo:code lang='ruby'>
# dependencies are generated using a strict version, don&#8217;t forget to edit the dependency versions when upgrading.
merb_gems_version = &#8220;1.0.7.1&#8221;
dm_gems_version   = &#8220;0.9.8&#8221;

# For more information about each component, please read http://wiki.merbivore.com/faqs/merb_components
dependency &#8220;merb-action-args&#8221;, merb_gems_version
dependency &#8220;merb-assets&#8221;, merb_gems_version  
dependency &#8220;merb-cache&#8221;, merb_gems_version   
dependency &#8220;merb-helpers&#8221;, merb_gems_version 
dependency &#8220;merb-mailer&#8221;, merb_gems_version  
dependency &#8220;merb-slices&#8221;, merb_gems_version  
dependency &#8220;merb-auth-core&#8221;, merb_gems_version
dependency &#8220;merb-auth-more&#8221;, merb_gems_version
dependency &#8220;merb-auth-slice-password&#8221;, merb_gems_version
dependency &#8220;merb-param-protection&#8221;, merb_gems_version
dependency &#8220;merb-exceptions&#8221;, merb_gems_version
 
dependency &#8220;dm-core&#8221;, dm_gems_version         
dependency &#8220;dm-aggregates&#8221;, dm_gems_version   
dependency &#8220;dm-migrations&#8221;, dm_gems_version   
dependency &#8220;dm-timestamps&#8221;, dm_gems_version   
dependency &#8220;dm-types&#8221;, dm_gems_version        
dependency &#8220;dm-validations&#8221;, dm_gems_version  

dependency &#8220;merb_datamapper&#8221;, merb_gems_version
dependency &#8220;do_sqlite3&#8221; # If using another database, replace this
</typo:code>

<p>On y liste ainsi tous les gems de merb et Datamapper que l&#8217;on souhaite utiliser. Si on veux en utiliser de nouveau, il suffit d&#8217;en ajouter à cette liste. Vous pouvez aussi en supprimer de cette liste pour diminuer ainsi le nombre de gem chargé dans votre application.</p>

<h2>Utilisation d&#8217;un repository de gems local à votre application</h2>

<p>Voici un point qui différe grandement de RubyOnRails. Mais à mon sens, là encore il est beaucoup mieux conçu que Rails. En effet, l&#8217;idée est très simple. Rubygems permet de définir le dossier où se trouve vos gems. Pourquoi ce répertoire ne serait pas simplement dans votre application ?</p>

<p>Pour mettre en place cette technique, il faut au préalable créer le dossier <code>/gems/</code> dans votre arborescence. Ensuite utiliser les tâches <code>thor</code> pour installer les gems que vous désirez directement dans votre nouveau répository gems. Ainsi pour installer merb-core et datamapper, il vous suffit de faire :</p>

<typo:code>
$ thor merb:gem:install merb-core dm-core
</typo:code>

<p>Une fois fait de même pour toutes vos dépendances. Vous avez freezé votre application avec tous les gems utilisés.</p>

<p>Si vous utilisez un gestionnaire de source, il faudra alors n&#8217;ajouter à votre repository que le dossier /gems/cache/ en effet, ce dossier contient les <code>.gem</code> que vous utilisez. Les autre dossiers seront générés. Ensuite si quelqu&#8217;un récupére vos sources, il lui suffira de réaliser la commande <code>thor</code> de redéploiement :</p>

<typo:code>
$ thor merb:gem:redeploy
</typo:code>

<p>Tous les gems dans le dossier cache seront ainsi installé dans votre dossier gems. Là où je trouve que ce système est meilleur que celui de Rails est que si vous avez un gem avec un extension C vous pouvez le freezer avec Merb. Chose que vous ne pouvez pas faire avec Rails.</p>

<h1>Mais et si je veux utiliser les versions de développement ?</h1>

<p>Voici selon moi le point faible de Merb face à Rails. En effet, avec rails, rien de plus simple. On met les sources dans le dossier <code>/vendor/</code> soit <code>/gems/</code> soit <code>/plugins/</code> et roulez jeunesse, tout fonctionne sans changement. Un simple git-submodule permet de suivre l&#8217;évolution du tout. Mais Merb ne permet pas ça. Merb ne loadera que des gems et uniquement des gems.</p>

<h2>Technique recommendée par la core-team</h2>

<p>La technique que finalement la core-team recommende est encore une fois de se baser sur les gems. Pour cela, rien de plus simple, il suffit de créer le gem correspondant à votre version de développement, l&#8217;ajouter dans le dossier <code>gems/cache</code> et ainsi l&#8217;utiliser. Des tâches utilitaires existent pour aider à tout ça. Par exemple pour installer la version de développement de Datamapper, vous pouvez faire :</p>

<typo:code>
$ thor merb:source:install dm-core
</typo:code>

<p>Cette tâche créera un clone du repository dm-core dans votre dossier <code>/src/</code>, générera le gem et installera dans votre dossier /gem/. Vous pouvez aussi faire de même en installant les sources directement dans le dossier <code>/src/</code> et utiliser le nom de votre dossier. Ca lancera la tâche <code>rake package</code> et installera le gem généré.</p>

<p>Ce que je trouve dommage avec cette technique est l&#8217;impossibilité de savoir réellement quel est la version utilisée. En effet, gem utilise un numéro de version fixe et on n&#8217;a pas forcement l&#8217;information du commit qui a généré ce gem. J&#8217;aime bien pouvoir juste en clonant un projet savoir exactement la source exact du gem que j&#8217;utilise. Donc soit sa version, soit son numéro de commit.</p>

<h2>Ma technique pour permettre de contourner le problème</h2>

<p>La technique que j&#8217;ai ainsi trouvé fonctionne, mais n&#8217;est hélas pas complétement optiminum. Dans mon fichier <code>config/init.rb</code>, j&#8217;ai créé une petite méthode :</p>

<typo:code lang='ruby'>
def load_from_source(src)
  $:.unshift File.join(Merb.root, &#8220;src/#{src}/lib&#8221;)
  require &#8220;src/#{src}/init.rb&#8221;
end
</typo:code>

<p>Ensuite dans le callback before_app_loads, j&#8217;ai pu faire appel à ma méthode</p>

<typo:code lang="ruby">
Merb::BootLoader.before_app_loads do
  # This will get executed after dependencies have been loaded but before your app&#8217;s classes have loaded.
  load_from_source(&#8216;will_paginate&#8217;)
end
</typo:code>

<p>Avec un clone du repository will_paginate dans mon dossier <code>/src/</code> will_paginate est ainsi chargé automatiquement avant le load de l&#8217;application et après le load de toutes les dépendances.</p>

<p>Par contre cette technique à un gros défaut que je n&#8217;ai pas réussi à palier sauf en proposant un patch à Merb (ce que je ferais peut-être, même si Merb en tant que tel est mort :&#8217;(). En effet, on ne peux loader à partir des sources qu&#8217;après le load des <code>dependancies</code>. Si vous voulez loader au milieu des dépendances, vous ne pouvez pas. Il faudra obligatoirement passer par le système des gems.</p>

<h2>Ce qu&#8217;il ne faut pas faire</h2>

<p>Je vous rassure, je l&#8217;ai fait, ce qui me permet de vous dire de ne pas le faire. Ainsi, il ne faut pas ajouter le require directement dans le <code>dependencies.rb</code>. En effet, le chargement des dépendences ne se fait pas à ce moment là. Ce n&#8217;est qu&#8217;un chargement d&#8217;une liste gems à charger. Si vous faites votre require à ce moment vous pourrez ainsi vous retrouver avec des problèmes d&#8217;ordre de chargement.</p>

<p><a href="http://blog.shingara.fr/en/2009-01-20-manage-your-dependencies-with-merb.html">English translation</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/dev-shingara-fr-mis-i-jour-avec-redmine-0-8.html">dev.shingara.fr mis à jour avec Redmine 0.8</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-12-31T00:00:00+01:00" pubdate data-updated="true">Dec 31<span>st</span>, 2008</time>
        
         | <a href="/dev-shingara-fr-mis-i-jour-avec-redmine-0-8.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Avec la sortie de Redmine 0.8 hier, j&#8217;ai mis à jour <a href="http://dev.shingara.fr/">ma plateforme de développement</a> sous cette nouvelle version. Pour ceux qui veulent des exemples, voici le fichier capistrano que j&#8217;utilise pour ce déploiement. Il est prévu pour récupérer les sources à partir de la branche 0.8 stable de redmine.</p>

<typo:code lang="ruby">
require &#8216;mongrel_cluster/recipes&#8217;

set :application, &#8220;redmine&#8221;
set :repository,  &#8220;http://redmine.rubyforge.org/svn/branches/0.8-stable&#8221;
set :domain, &#8220;shingara.fr&#8221;

# If you aren&#8217;t deploying to /u/apps/#{application} on the target
# servers (which is the default), you can specify the actual location
# via the :deploy_to variable:
set :deploy_to, &#8220;/var/rails/#{application}&#8221;

# If you aren&#8217;t using Subversion to manage your source code, specify
# your SCM below:
set :scm, :subversion

set :runner, &#8220;rails&#8221;
set :user, &#8220;rails&#8221;
set :use_sudo, false
set :mongrel_conf, &#8220;#{current_path}/config/mongrel_cluster.yml&#8221;

role :app, domain
role :web, domain
role :db,  domain, :primary => true

task :update_config, :roles => [:app] do
  run &#8220;cp -Rf #{shared_path}/config/* #{release_path}/config/&#8221;
end

after &#8220;deploy:update_code&#8221;, :update_config
</typo:code>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/quiet-assets-le-limiteur-de-log.html">Quiet Assets le gem qui limite les logs</a>
      </li>
    
      <li class="post">
        <a href="/telecharger-fichier-de-basecamp.html">Récupération de ses fichiers sur basecamp</a>
      </li>
    
      <li class="post">
        <a href="/translate-on-mongoid.html">Localize avec mongoid</a>
      </li>
    
      <li class="post">
        <a href="/mailtrap-l-aide-au-staging.html">Mailtrap l&#8217;aide au staging</a>
      </li>
    
      <li class="post">
        <a href="/une-journee-dediee-i-mongodb.html">Une journée dédiée à MongoDB</a>
      </li>
    
      <li class="post">
        <a href="/periodictimer-de-eventmachine-le-cron-simplifie.html">PeriodicTimer de EventMachine, le cron simplifié</a>
      </li>
    
      <li class="post">
        <a href="/oupsnow-0-5-0-est-sortie.html">Oupsnow 0.5.0 est sortie</a>
      </li>
    
      <li class="post">
        <a href="/pourquoi-ruby-et-ruby-on-rails-dans-le-developpement-dapplication-web.html">Pourquoi Ruby et Ruby On Rails dans le développement d&#8217;application web ?</a>
      </li>
    
      <li class="post">
        <a href="/que-cherche-un-developpeur-dans-une-offre-demploi.html">Que cherche un développeur dans une offre d&#8217;emploi ?</a>
      </li>
    
      <li class="post">
        <a href="/sortie-de-typo-5-4-0.html">Sortie de Typo 5.4.0</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/shingara">@shingara</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'shingara',
            count: 10,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("shingara", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/shingara" class="twitter-follow-button" data-show-count="true">Follow @shingara</a>
  
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Cyril Mougel -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'shinydevblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
